<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis ICD10 - urg_torre</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            color: #333;
        }
        .header {
            background: linear-gradient(135deg, #0066cc 0%, #004499 100%);
            color: white;
            padding: 30px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .subtitle {
            margin-top: 10px;
            opacity: 0.9;
        }
        .tabs {
            background: white;
            padding: 0;
            display: flex;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .tab {
            padding: 20px 30px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        .tab:hover {
            color: #0066cc;
            background: rgba(0,102,204,0.05);
        }
        .tab.active {
            color: #0066cc;
            border-bottom-color: #0066cc;
        }
        .content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .metric {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
            transition: transform 0.3s;
        }
        .metric:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .metric-value {
            font-size: 3em;
            font-weight: bold;
            color: #0066cc;
            margin: 10px 0;
        }
        .metric-label {
            color: #666;
            font-size: 1em;
        }
        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }
        .chart-container canvas {
            max-height: 400px !important;
            display: block !important;
        }
        .chart-title {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .chart-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        @media (max-width: 968px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }
        #sunburstChart {
            width: 100%;
            height: 600px;
        }
        .breadcrumb {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #666;
        }
        .breadcrumb span {
            color: #0066cc;
            font-weight: 500;
        }
        .info-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .info-row:last-child {
            border-bottom: none;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .text-right {
            text-align: right;
        }
        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 500;
        }
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }
        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }
        .diversity-indicator {
            display: inline-block;
            padding: 8px 20px;
            border-radius: 25px;
            background: #28a745;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
        }
        .coverage-bar {
            width: 100%;
            height: 40px;
            background: #e9ecef;
            border-radius: 20px;
            overflow: hidden;
            margin: 20px 0;
        }
        .coverage-fill {
            height: 100%;
            background: #28a745;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            width: 100.0%;
            transition: width 1s ease;
        }
        .filter-controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .filter-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        select {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        button {
            padding: 8px 20px;
            border: none;
            border-radius: 5px;
            background: #0066cc;
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }
        button:hover {
            background: #0052a3;
        }
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 12px;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Análisis de Diversidad ICD10</h1>
        <div class="subtitle">urg_torre - 6,243 casos analizados</div>
    </div>
    
    <div class="tabs">
        <button class="tab active" onclick="showTab('overview')">Resumen</button>
        <button class="tab" onclick="showTab('charts')">Gráficos</button>
        <button class="tab" onclick="showTab('hierarchy')">Jerarquía Interactiva</button>
        <button class="tab" onclick="showTab('details')">Tabla Detallada</button>
        <button class="tab" onclick="showTab('analysis')">Análisis Profundo</button>
    </div>
    
    <div class="content">
        <!-- Tab 1: Overview -->
        <div id="overview" class="tab-content active">
            <div class="metrics">
                <div class="metric">
                    <div class="metric-label">Total de Casos</div>
                    <div class="metric-value">6,243</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Con Códigos ICD10</div>
                    <div class="metric-value">6,243</div>
                    <div class="metric-label">100.0% cobertura</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Códigos Únicos</div>
                    <div class="metric-value">873</div>
                </div>
                <div class="metric">
                    <div class="metric-label">Diversidad</div>
                    <div class="metric-value">
                        <span class="diversity-indicator">Alta</span>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <h2 class="chart-title">Cobertura de Códigos ICD10</h2>
                <div class="coverage-bar">
                    <div class="coverage-fill">100.0%</div>
                </div>
                
            </div>
            
            <div class="chart-container">
                <h2 class="chart-title">Resumen de Diversidad</h2>
                <div class="info-panel">
                    <div class="info-row">
                        <span>Capítulos ICD10 cubiertos</span>
                        <strong>22 de 22</strong>
                    </div>
                    <div class="info-row">
                        <span>Categorías únicas (3 caracteres)</span>
                        <strong>369</strong>
                    </div>
                    <div class="info-row">
                        <span>Subcategorías detalladas</span>
                        <strong>772</strong>
                    </div>
                    <div class="info-row">
                        <span>Códigos no reconocidos</span>
                        <strong>0</strong>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Tab 2: Charts -->
        <div id="charts" class="tab-content">
            <div class="chart-grid">
                <div class="chart-container">
                    <h2 class="chart-title">Distribución por Capítulos (Top 10)</h2>
                    <canvas id="chapterPieChart" style="max-width: 100%; height: 400px;"></canvas>
                </div>
                <div class="chart-container">
                    <h2 class="chart-title">Casos por Capítulo</h2>
                    <canvas id="chapterBarChart" style="max-width: 100%; height: 400px;"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <h2 class="chart-title">Tendencia de Diversidad por Categorías</h2>
                <canvas id="categoryChart" style="max-width: 100%; height: 300px;"></canvas>
            </div>
        </div>
        
        <!-- Tab 3: Interactive Hierarchy -->
        <div id="hierarchy" class="tab-content">
            <div class="filter-controls">
                <div class="filter-group">
                    <label>Nivel de detalle:</label>
                    <select id="depthSelector" onchange="updateSunburst()">
                        <option value="2">Capítulos y Categorías</option>
                        <option value="3" selected>Hasta Bloques</option>
                        <option value="4">Detalle Completo</option>
                    </select>
                    <button onclick="resetZoom()">Restablecer Vista</button>
                </div>
            </div>
            
            <div class="breadcrumb" id="breadcrumb">
                <span>ICD10</span> → Haz clic en cualquier sección para explorar
            </div>
            
            <div class="chart-container">
                <h2 class="chart-title">Exploración Jerárquica Interactiva</h2>
                <div id="sunburstChart"></div>
                <div class="info-panel" id="selectionInfo" style="display: none;">
                    <h3 id="selectionTitle"></h3>
                    <div id="selectionDetails"></div>
                </div>
            </div>
        </div>
        
        <!-- Tab 4: Detailed Table -->
        <div id="details" class="tab-content">
            <div class="chart-container">
                <h2 class="chart-title">Tabla Detallada por Capítulos</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Capítulo</th>
                            <th class="text-right">Casos</th>
                            <th class="text-right">%</th>
                            <th class="text-right">Códigos Únicos</th>
                            <th class="text-right">Estado</th>
                        </tr>
                    </thead>
                    <tbody>
                        
        <tr>
            <td>X: Diseases of the respiratory system</td>
            <td class="text-right">2,258</td>
            <td class="text-right">36.17%</td>
            <td class="text-right">49</td>
            <td class="text-right"><span class="badge badge-success">Alto</span></td>
        </tr>
        
        <tr>
            <td>XIX: Injury, poisoning and certain other consequences of external causes</td>
            <td class="text-right">804</td>
            <td class="text-right">12.88%</td>
            <td class="text-right">281</td>
            <td class="text-right"><span class="badge badge-success">Alto</span></td>
        </tr>
        
        <tr>
            <td>XIII: Diseases of the musculoskeletal system and connective tissue</td>
            <td class="text-right">604</td>
            <td class="text-right">9.67%</td>
            <td class="text-right">152</td>
            <td class="text-right"><span class="badge badge-warning">Medio</span></td>
        </tr>
        
        <tr>
            <td>XVIII: Symptoms, signs and abnormal clinical and laboratory findings, not elsewhere classified</td>
            <td class="text-right">507</td>
            <td class="text-right">8.12%</td>
            <td class="text-right">66</td>
            <td class="text-right"><span class="badge badge-warning">Medio</span></td>
        </tr>
        
        <tr>
            <td>I: Certain infectious and parasitic diseases</td>
            <td class="text-right">477</td>
            <td class="text-right">7.64%</td>
            <td class="text-right">31</td>
            <td class="text-right"><span class="badge badge-warning">Medio</span></td>
        </tr>
        
        <tr>
            <td>VIII: Diseases of the ear and mastoid process</td>
            <td class="text-right">323</td>
            <td class="text-right">5.17%</td>
            <td class="text-right">34</td>
            <td class="text-right"><span class="badge badge-warning">Medio</span></td>
        </tr>
        
        <tr>
            <td>XIV: Diseases of the genitourinary system</td>
            <td class="text-right">318</td>
            <td class="text-right">5.09%</td>
            <td class="text-right">37</td>
            <td class="text-right"><span class="badge badge-warning">Medio</span></td>
        </tr>
        
        <tr>
            <td>XI: Diseases of the digestive system</td>
            <td class="text-right">298</td>
            <td class="text-right">4.77%</td>
            <td class="text-right">46</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>VII: Diseases of the eye and adnexa</td>
            <td class="text-right">205</td>
            <td class="text-right">3.28%</td>
            <td class="text-right">44</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>XII: Diseases of the skin and subcutaneous tissue</td>
            <td class="text-right">162</td>
            <td class="text-right">2.59%</td>
            <td class="text-right">47</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>IX: Diseases of the circulatory system</td>
            <td class="text-right">80</td>
            <td class="text-right">1.28%</td>
            <td class="text-right">28</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>XXII: Codes for special purposes</td>
            <td class="text-right">70</td>
            <td class="text-right">1.12%</td>
            <td class="text-right">1</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>VI: Diseases of the nervous system</td>
            <td class="text-right">64</td>
            <td class="text-right">1.03%</td>
            <td class="text-right">17</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>V: Mental and behavioural disorders</td>
            <td class="text-right">31</td>
            <td class="text-right">0.5%</td>
            <td class="text-right">7</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>XXI: Factors influencing health status and contact with health services</td>
            <td class="text-right">16</td>
            <td class="text-right">0.26%</td>
            <td class="text-right">14</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>IV: Endocrine, nutritional and metabolic diseases</td>
            <td class="text-right">8</td>
            <td class="text-right">0.13%</td>
            <td class="text-right">5</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>II: Neoplasms</td>
            <td class="text-right">5</td>
            <td class="text-right">0.08%</td>
            <td class="text-right">4</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>XVI: Certain conditions originating in the perinatal period</td>
            <td class="text-right">3</td>
            <td class="text-right">0.05%</td>
            <td class="text-right">3</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>XX: External causes of morbidity and mortality</td>
            <td class="text-right">3</td>
            <td class="text-right">0.05%</td>
            <td class="text-right">2</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>III: Diseases of the blood and blood-forming organs and certain disorders involving the immune mechanism</td>
            <td class="text-right">3</td>
            <td class="text-right">0.05%</td>
            <td class="text-right">1</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>XVII: Congenital malformations, deformations and chromosomal abnormalities</td>
            <td class="text-right">2</td>
            <td class="text-right">0.03%</td>
            <td class="text-right">2</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
        <tr>
            <td>XV: Pregnancy, childbirth and the puerperium</td>
            <td class="text-right">2</td>
            <td class="text-right">0.03%</td>
            <td class="text-right">2</td>
            <td class="text-right"><span class="badge badge-danger">Bajo</span></td>
        </tr>
        
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Tab 5: Deep Analysis -->
        <div id="analysis" class="tab-content">
            <div class="chart-container">
                <h2 class="chart-title">Análisis de Concentración</h2>
                <canvas id="concentrationChart" style="max-width: 100%; height: 400px;"></canvas>
            </div>
            
            <div class="chart-container">
                <h2 class="chart-title">Matriz de Especialidades Médicas</h2>
                <div id="specialtyMatrix"></div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        // Global data
        const chapterData = [{"name": "Diseases of the respiratory system", "value": 2258}, {"name": "Injury, poisoning and certain other consequences of external causes", "value": 804}, {"name": "Diseases of the musculoskeletal system and connective tissue", "value": 604}, {"name": "Symptoms, signs and abnormal clinical and laboratory findings, not elsewhere classified", "value": 507}, {"name": "Certain infectious and parasitic diseases", "value": 477}, {"name": "Diseases of the ear and mastoid process", "value": 323}, {"name": "Diseases of the genitourinary system", "value": 318}, {"name": "Diseases of the digestive system", "value": 298}, {"name": "Diseases of the eye and adnexa", "value": 205}, {"name": "Diseases of the skin and subcutaneous tissue", "value": 162}];
        const hierarchyTree = {"name": "ICD10", "value": 6243, "children": [{"name": "XIX: Injury, poisoning and certain other consequences of external causes", "code": "XIX", "value": 494, "children": [{"name": "S62: Fracture at wrist and hand level", "code": "S62", "value": 18}, {"name": "S06: Intracranial injury", "code": "S06", "value": 22}, {"name": "S52: Fracture of forearm", "code": "S52", "value": 22}, {"name": "S65: Injury of blood vessels at wrist and hand level", "code": "S65", "value": 1}, {"name": "S93: Dislocation and sprain of joints and ligaments at ", "code": "S93", "value": 114}, {"name": "S90: Superficial injury of ankle, foot and toes", "code": "S90", "value": 15}, {"name": "S63: Dislocation and sprain of joints and ligaments at ", "code": "S63", "value": 47}, {"name": "S60: Superficial injury of wrist, hand and fingers", "code": "S60", "value": 64}, {"name": "S99: Other and unspecified injuries of ankle and foot", "code": "S99", "value": 14}, {"name": "S61: Open wound of wrist, hand and fingers", "code": "S61", "value": 48}, {"name": "T17: Foreign body in respiratory tract", "code": "T17", "value": 5}, {"name": "S42: Fracture of shoulder and upper arm", "code": "S42", "value": 13}, {"name": "S83: Dislocation and sprain of joints and ligaments of ", "code": "S83", "value": 3}, {"name": "S92: Fracture of foot and toe, except ankle", "code": "S92", "value": 13}, {"name": "S43: Dislocation and sprain of joints and ligaments of ", "code": "S43", "value": 4}, {"name": "S76: Injury of muscle, fascia and tendon at hip and thi", "code": "S76", "value": 6}, {"name": "S81: Open wound of knee and lower leg", "code": "S81", "value": 4}, {"name": "S82: Fracture of lower leg, including ankle", "code": "S82", "value": 8}, {"name": "S02: Fracture of skull and facial bones", "code": "S02", "value": 1}, {"name": "S01: Open wound of head", "code": "S01", "value": 14}, {"name": "T22: Burn and corrosion of shoulder and upper limb, exc", "code": "T22", "value": 1}, {"name": "S32: Fracture of lumbar spine and pelvis", "code": "S32", "value": 5}, {"name": "S86: Injury of muscle, fascia and tendon at lower leg l", "code": "S86", "value": 13}, {"name": "T25: Burn and corrosion of ankle and foot", "code": "T25", "value": 2}, {"name": "S40: Superficial injury of shoulder and upper arm", "code": "S40", "value": 4}, {"name": "S53: Dislocation and sprain of joints and ligaments of ", "code": "S53", "value": 4}, {"name": "S46: Injury of muscle, fascia and tendon at shoulder an", "code": "S46", "value": 2}, {"name": "S20: Superficial injury of thorax", "code": "S20", "value": 3}, {"name": "S71: Open wound of hip and thigh", "code": "S71", "value": 2}, {"name": "S91: Open wound of ankle, foot and toes", "code": "S91", "value": 3}, {"name": "T50: Poisoning by, adverse effect of and underdosing of", "code": "T50", "value": 1}, {"name": "T23: Burn and corrosion of wrist and hand", "code": "T23", "value": 3}, {"name": "T83: Complications of genitourinary prosthetic devices,", "code": "T83", "value": 1}, {"name": "S66: Injury of muscle, fascia and tendon at wrist and h", "code": "S66", "value": 1}, {"name": "S59: Other and unspecified injuries of elbow and forear", "code": "S59", "value": 1}, {"name": "S80: Superficial injury of knee and lower leg", "code": "S80", "value": 1}, {"name": "S36: Injury of intra-abdominal organs", "code": "S36", "value": 1}, {"name": "T30: Burn and corrosion, body region unspecified", "code": "T30", "value": 1}, {"name": "S79: Other and unspecified injuries of hip and thigh", "code": "S79", "value": 1}, {"name": "T18: Foreign body in alimentary tract", "code": "T18", "value": 3}, {"name": "S00: Superficial injury of head", "code": "S00", "value": 1}, {"name": "S22: Fracture of rib(s), sternum and thoracic spine", "code": "S22", "value": 2}, {"name": "S72: Fracture of femur", "code": "S72", "value": 2}]}, {"name": "VIII: Diseases of the ear and mastoid process", "code": "VIII", "value": 323, "children": [{"name": "H60: Otitis externa", "code": "H60", "value": 50}, {"name": "H66: Suppurative and unspecified otitis media", "code": "H66", "value": 185}, {"name": "H61: Other disorders of external ear", "code": "H61", "value": 12}, {"name": "H81: Disorders of vestibular function", "code": "H81", "value": 35}, {"name": "H65: Nonsuppurative otitis media", "code": "H65", "value": 15}, {"name": "H92: Otalgia and effusion of ear", "code": "H92", "value": 17}, {"name": "H80: Otosclerosis", "code": "H80", "value": 1}, {"name": "H73: Other disorders of tympanic membrane", "code": "H73", "value": 4}, {"name": "H72: Perforation of tympanic membrane", "code": "H72", "value": 2}, {"name": "H93: Other disorders of ear, not elsewhere classified", "code": "H93", "value": 2}]}, {"name": "XI: Diseases of the digestive system", "code": "XI", "value": 298, "children": [{"name": "K64: Hemorrhoids and perianal venous thrombosis", "code": "K64", "value": 10}, {"name": "K52: Other and unspecified noninfective gastroenteritis", "code": "K52", "value": 150}, {"name": "K62: Other diseases of anus and rectum", "code": "K62", "value": 7}, {"name": "K59: Other functional intestinal disorders", "code": "K59", "value": 13}, {"name": "K08: Other disorders of teeth and supporting structures", "code": "K08", "value": 13}, {"name": "K13: Other diseases of lip and oral mucosa", "code": "K13", "value": 4}, {"name": "K61: Abscess of anal and rectal regions", "code": "K61", "value": 4}, {"name": "K11: Diseases of salivary glands", "code": "K11", "value": 10}, {"name": "K04: Diseases of pulp and periapical tissues", "code": "K04", "value": 4}, {"name": "K29: Gastritis and duodenitis", "code": "K29", "value": 6}, {"name": "K06: Other disorders of gingiva and edentulous alveolar", "code": "K06", "value": 2}, {"name": "K35: Acute appendicitis", "code": "K35", "value": 10}, {"name": "K31: Other diseases of stomach and duodenum", "code": "K31", "value": 1}, {"name": "K60: Fissure and fistula of anal and rectal regions", "code": "K60", "value": 7}, {"name": "K02: Dental caries", "code": "K02", "value": 1}, {"name": "K91: Intraoperative and postprocedural complications an", "code": "K91", "value": 1}, {"name": "K21: Gastro-esophageal reflux disease", "code": "K21", "value": 2}, {"name": "K80: Cholelithiasis", "code": "K80", "value": 7}, {"name": "K42: Umbilical hernia", "code": "K42", "value": 1}, {"name": "K56: Paralytic ileus and intestinal obstruction without", "code": "K56", "value": 5}, {"name": "K12: Stomatitis and related lesions", "code": "K12", "value": 6}, {"name": "K58: Irritable bowel syndrome", "code": "K58", "value": 1}, {"name": "K90: Intestinal malabsorption", "code": "K90", "value": 1}, {"name": "K14: Diseases of tongue", "code": "K14", "value": 1}, {"name": "K92: Other diseases of digestive system", "code": "K92", "value": 4}, {"name": "K65: Peritonitis", "code": "K65", "value": 2}, {"name": "K40: Inguinal hernia", "code": "K40", "value": 1}, {"name": "K05: Gingivitis and periodontal diseases", "code": "K05", "value": 2}, {"name": "K85: Acute pancreatitis", "code": "K85", "value": 4}, {"name": "K57: Diverticular disease of intestine", "code": "K57", "value": 9}, {"name": "K81: Cholecystitis", "code": "K81", "value": 3}]}, {"name": "X: Diseases of the respiratory system", "code": "X", "value": 2258, "children": [{"name": "J98: Other respiratory disorders", "code": "J98", "value": 371}, {"name": "J18: Pneumonia, unspecified organism", "code": "J18", "value": 82}, {"name": "J03: Acute tonsillitis", "code": "J03", "value": 266}, {"name": "J02: Acute pharyngitis", "code": "J02", "value": 342}, {"name": "J34: Other and unspecified disorders of nose and nasal ", "code": "J34", "value": 1}, {"name": "J21: Acute bronchiolitis", "code": "J21", "value": 50}, {"name": "J06: Acute upper respiratory infections of multiple and", "code": "J06", "value": 410}, {"name": "J20: Acute bronchitis", "code": "J20", "value": 93}, {"name": "J11: Influenza due to unidentified influenza virus", "code": "J11", "value": 33}, {"name": "J04: Acute laryngitis and tracheitis", "code": "J04", "value": 115}, {"name": "J32: Chronic sinusitis", "code": "J32", "value": 38}, {"name": "J45: Asthma", "code": "J45", "value": 17}, {"name": "J39: Other diseases of upper respiratory tract", "code": "J39", "value": 2}, {"name": "J01: Acute sinusitis", "code": "J01", "value": 21}, {"name": "J44: Other chronic obstructive pulmonary disease", "code": "J44", "value": 8}, {"name": "J84: Other interstitial pulmonary diseases", "code": "J84", "value": 1}, {"name": "J10: Influenza due to other identified influenza virus", "code": "J10", "value": 5}, {"name": "J30: Vasomotor and allergic rhinitis", "code": "J30", "value": 3}, {"name": "J31: Chronic rhinitis, nasopharyngitis and pharyngitis", "code": "J31", "value": 9}, {"name": "J12: Viral pneumonia, not elsewhere classified", "code": "J12", "value": 2}, {"name": "J68: Respiratory conditions due to inhalation of chemic", "code": "J68", "value": 2}, {"name": "J96: Respiratory failure, not elsewhere classified", "code": "J96", "value": 14}, {"name": "J47: Bronchiectasis", "code": "J47", "value": 2}, {"name": "J69: Pneumonitis due to solids and liquids", "code": "J69", "value": 1}, {"name": "J05: Acute obstructive laryngitis [croup] and epiglotti", "code": "J05", "value": 1}]}, {"name": "XVIII: Symptoms, signs and abnormal clinical and laboratory findings, not elsewhere classified", "code": "XVIII", "value": 507, "children": [{"name": "R07: Pain in throat and chest", "code": "R07", "value": 77}, {"name": "R10: Abdominal and pelvic pain", "code": "R10", "value": 115}, {"name": "R19: Other symptoms and signs involving the digestive s", "code": "R19", "value": 26}, {"name": "R51: Headache", "code": "R51", "value": 38}, {"name": "R00: Abnormalities of heart beat", "code": "R00", "value": 10}, {"name": "R50: Fever of other and unknown origin", "code": "R50", "value": 34}, {"name": "R11: Nausea and vomiting", "code": "R11", "value": 23}, {"name": "R30: Pain associated with micturition", "code": "R30", "value": 4}, {"name": "R25: Abnormal involuntary movements", "code": "R25", "value": 2}, {"name": "R09: Other symptoms and signs involving the circulatory", "code": "R09", "value": 2}, {"name": "R49: Voice and resonance disorders", "code": "R49", "value": 2}, {"name": "R20: Disturbances of skin sensation", "code": "R20", "value": 8}, {"name": "R60: Edema, not elsewhere classified", "code": "R60", "value": 4}, {"name": "R31: Hematuria", "code": "R31", "value": 3}, {"name": "R79: Other abnormal findings of blood chemistry", "code": "R79", "value": 2}, {"name": "R22: Localized swelling, mass and lump of skin and subc", "code": "R22", "value": 5}, {"name": "R53: Malaise and fatigue", "code": "R53", "value": 8}, {"name": "R04: Hemorrhage from respiratory passages", "code": "R04", "value": 8}, {"name": "R68: Other general symptoms and signs", "code": "R68", "value": 1}, {"name": "R33: Retention of urine", "code": "R33", "value": 9}, {"name": "R59: Enlarged lymph nodes", "code": "R59", "value": 9}, {"name": "R14: Flatulence and related conditions", "code": "R14", "value": 12}, {"name": "R06: Abnormalities of breathing", "code": "R06", "value": 3}, {"name": "R39: Other and unspecified symptoms and signs involving", "code": "R39", "value": 4}, {"name": "R35: Polyuria", "code": "R35", "value": 2}, {"name": "R41: Other symptoms and signs involving cognitive funct", "code": "R41", "value": 1}, {"name": "R23: Other skin changes", "code": "R23", "value": 1}, {"name": "R73: Elevated blood glucose level", "code": "R73", "value": 1}, {"name": "R63: Symptoms and signs concerning food and fluid intak", "code": "R63", "value": 1}, {"name": "R36: Urethral discharge", "code": "R36", "value": 1}, {"name": "R56: Convulsions, not elsewhere classified", "code": "R56", "value": 2}, {"name": "R16: Hepatomegaly and splenomegaly, not elsewhere class", "code": "R16", "value": 1}]}, {"name": "XIV: Diseases of the genitourinary system", "code": "XIV", "value": 318, "children": [{"name": "N39: Other disorders of urinary system", "code": "N39", "value": 165}, {"name": "N41: Inflammatory diseases of prostate", "code": "N41", "value": 9}, {"name": "N30: Cystitis", "code": "N30", "value": 38}, {"name": "N76: Other inflammation of vagina and vulva", "code": "N76", "value": 4}, {"name": "N18: Chronic kidney disease (CKD)", "code": "N18", "value": 1}, {"name": "N45: Orchitis and epididymitis", "code": "N45", "value": 8}, {"name": "N36: Other disorders of urethra", "code": "N36", "value": 1}, {"name": "N48: Other disorders of penis", "code": "N48", "value": 5}, {"name": "N47: Disorders of prepuce", "code": "N47", "value": 1}, {"name": "N50: Other and unspecified disorders of male genital or", "code": "N50", "value": 7}, {"name": "N40: Benign prostatic hyperplasia", "code": "N40", "value": 1}, {"name": "N64: Other disorders of breast", "code": "N64", "value": 3}, {"name": "N94: Pain and other conditions associated with female g", "code": "N94", "value": 2}, {"name": "N31: Neuromuscular dysfunction of bladder, not elsewher", "code": "N31", "value": 1}, {"name": "N34: Urethritis and urethral syndrome", "code": "N34", "value": 4}, {"name": "N99: Intraoperative and postprocedural complications an", "code": "N99", "value": 2}, {"name": "N13: Obstructive and reflux uropathy", "code": "N13", "value": 3}, {"name": "N89: Other noninflammatory disorders of vagina", "code": "N89", "value": 1}, {"name": "N49: Inflammatory disorders of male genital organs, not", "code": "N49", "value": 2}, {"name": "N73: Other female pelvic inflammatory diseases", "code": "N73", "value": 1}, {"name": "N32: Other disorders of bladder", "code": "N32", "value": 1}, {"name": "N20: Calculus of kidney and ureter", "code": "N20", "value": 2}, {"name": "N28: Other disorders of kidney and ureter, not elsewher", "code": "N28", "value": 1}, {"name": "N05: Unspecified nephritic syndrome", "code": "N05", "value": 1}]}, {"name": "XIII: Diseases of the musculoskeletal system and connective tissue", "code": "XIII", "value": 604, "children": [{"name": "M62: Other disorders of muscle", "code": "M62", "value": 19}, {"name": "M25: Other joint disorder, not elsewhere classified", "code": "M25", "value": 73}, {"name": "M54: Dorsalgia", "code": "M54", "value": 213}, {"name": "M12: Other and unspecified arthropathy", "code": "M12", "value": 13}, {"name": "M26: Dentofacial anomalies [including malocclusion]", "code": "M26", "value": 2}, {"name": "M53: Other and unspecified dorsopathies, not elsewhere ", "code": "M53", "value": 7}, {"name": "M75: Shoulder lesions", "code": "M75", "value": 24}, {"name": "M65: Synovitis and tenosynovitis", "code": "M65", "value": 31}, {"name": "M76: Enthesopathies, lower limb, excluding foot", "code": "M76", "value": 26}, {"name": "M94: Other disorders of cartilage", "code": "M94", "value": 7}, {"name": "M13: Other arthritis", "code": "M13", "value": 8}, {"name": "M79: Other and unspecified soft tissue disorders, not e", "code": "M79", "value": 44}, {"name": "M51: Thoracic, thoracolumbar, and lumbosacral intervert", "code": "M51", "value": 12}, {"name": "M24: Other specific joint derangements", "code": "M24", "value": 2}, {"name": "M77: Other enthesopathies", "code": "M77", "value": 27}, {"name": "M70: Soft tissue disorders related to use, overuse and ", "code": "M70", "value": 18}, {"name": "M22: Disorder of patella", "code": "M22", "value": 2}, {"name": "M17: Osteoarthritis of knee", "code": "M17", "value": 9}, {"name": "M93: Other osteochondropathies", "code": "M93", "value": 12}, {"name": "M89: Other disorders of bone", "code": "M89", "value": 5}, {"name": "M19: Other and unspecified osteoarthritis", "code": "M19", "value": 7}, {"name": "M06: Other rheumatoid arthritis", "code": "M06", "value": 1}, {"name": "M47: Spondylosis", "code": "M47", "value": 3}, {"name": "M72: Fibroblastic disorders", "code": "M72", "value": 7}, {"name": "M23: Internal derangement of knee", "code": "M23", "value": 4}, {"name": "M10: Gout", "code": "M10", "value": 11}, {"name": "M20: Acquired deformities of fingers and toes", "code": "M20", "value": 1}, {"name": "M92: Other juvenile osteochondrosis", "code": "M92", "value": 1}, {"name": "M43: Other deforming dorsopathies", "code": "M43", "value": 2}, {"name": "M18: Osteoarthritis of first carpometacarpal joint", "code": "M18", "value": 2}, {"name": "M67: Other disorders of synovium and tendon", "code": "M67", "value": 1}, {"name": "M71: Other bursopathies", "code": "M71", "value": 4}, {"name": "M16: Osteoarthritis of hip", "code": "M16", "value": 2}, {"name": "M04: Autoinflammatory syndromes", "code": "M04", "value": 1}, {"name": "M02: Postinfective and reactive arthropathies", "code": "M02", "value": 1}, {"name": "M81: Osteoporosis without current pathological fracture", "code": "M81", "value": 1}, {"name": "M50: Cervical disc disorders", "code": "M50", "value": 1}]}, {"name": "VII: Diseases of the eye and adnexa", "code": "VII", "value": 205, "children": [{"name": "H11: Other disorders of conjunctiva", "code": "H11", "value": 24}, {"name": "H10: Conjunctivitis", "code": "H10", "value": 108}, {"name": "H00: Hordeolum and chalazion", "code": "H00", "value": 23}, {"name": "H15: Disorders of sclera", "code": "H15", "value": 2}, {"name": "H16: Keratitis", "code": "H16", "value": 10}, {"name": "H01: Other inflammation of eyelid", "code": "H01", "value": 13}, {"name": "H20: Iridocyclitis", "code": "H20", "value": 1}, {"name": "H53: Visual disturbances", "code": "H53", "value": 10}, {"name": "H43: Disorders of vitreous body", "code": "H43", "value": 5}, {"name": "H02: Other disorders of eyelid", "code": "H02", "value": 1}, {"name": "H57: Other disorders of eye and adnexa", "code": "H57", "value": 5}, {"name": "H40: Glaucoma", "code": "H40", "value": 1}, {"name": "H04: Disorders of lacrimal system", "code": "H04", "value": 1}, {"name": "H44: Disorders of globe", "code": "H44", "value": 1}]}, {"name": "IX: Diseases of the circulatory system", "code": "IX", "value": 80, "children": [{"name": "I16: Hypertensive crisis", "code": "I16", "value": 17}, {"name": "I88: Nonspecific lymphadenitis", "code": "I88", "value": 1}, {"name": "I49: Other cardiac arrhythmias", "code": "I49", "value": 7}, {"name": "I30: Acute pericarditis", "code": "I30", "value": 2}, {"name": "I48: Atrial fibrillation and flutter", "code": "I48", "value": 8}, {"name": "I87: Other disorders of veins", "code": "I87", "value": 1}, {"name": "I50: Heart failure", "code": "I50", "value": 11}, {"name": "I47: Paroxysmal tachycardia", "code": "I47", "value": 3}, {"name": "I80: Phlebitis and thrombophlebitis", "code": "I80", "value": 2}, {"name": "I82: Other venous embolism and thrombosis", "code": "I82", "value": 1}, {"name": "I83: Varicose veins of lower extremities", "code": "I83", "value": 1}, {"name": "I31: Other diseases of pericardium", "code": "I31", "value": 2}, {"name": "I63: Cerebral infarction", "code": "I63", "value": 3}, {"name": "I26: Pulmonary embolism", "code": "I26", "value": 1}, {"name": "I75: Atheroembolism", "code": "I75", "value": 1}, {"name": "I20: Angina pectoris", "code": "I20", "value": 3}, {"name": "I99: Other and unspecified disorders of circulatory sys", "code": "I99", "value": 1}, {"name": "I21: Acute myocardial infarction", "code": "I21", "value": 1}, {"name": "I25: Chronic ischemic heart disease", "code": "I25", "value": 1}]}, {"name": "VI: Diseases of the nervous system", "code": "VI", "value": 64, "children": [{"name": "G57: Mononeuropathies of lower limb", "code": "G57", "value": 5}, {"name": "G43: Migraine", "code": "G43", "value": 24}, {"name": "G44: Other headache syndromes", "code": "G44", "value": 11}, {"name": "G89: Pain, not elsewhere classified", "code": "G89", "value": 4}, {"name": "G58: Other mononeuropathies", "code": "G58", "value": 10}, {"name": "G51: Facial nerve disorders", "code": "G51", "value": 1}, {"name": "G83: Other paralytic syndromes", "code": "G83", "value": 1}, {"name": "G45: Transient cerebral ischemic attacks and related sy", "code": "G45", "value": 5}, {"name": "G47: Sleep disorders", "code": "G47", "value": 1}, {"name": "G90: Disorders of autonomic nervous system", "code": "G90", "value": 1}, {"name": "G04: Encephalitis, myelitis and encephalomyelitis", "code": "G04", "value": 1}]}, {"name": "XII: Diseases of the skin and subcutaneous tissue", "code": "XII", "value": 162, "children": [{"name": "L60: Nail disorders", "code": "L60", "value": 9}, {"name": "L30: Other and unspecified dermatitis", "code": "L30", "value": 19}, {"name": "L13: Other bullous disorders", "code": "L13", "value": 1}, {"name": "L08: Other local infections of skin and subcutaneous ti", "code": "L08", "value": 4}, {"name": "L76: Intraoperative and postprocedural complications of", "code": "L76", "value": 2}, {"name": "L50: Urticaria", "code": "L50", "value": 28}, {"name": "L23: Allergic contact dermatitis", "code": "L23", "value": 2}, {"name": "L72: Follicular cysts of skin and subcutaneous tissue", "code": "L72", "value": 3}, {"name": "L03: Cellulitis and acute lymphangitis", "code": "L03", "value": 29}, {"name": "L29: Pruritus", "code": "L29", "value": 2}, {"name": "L28: Lichen simplex chronicus and prurigo", "code": "L28", "value": 4}, {"name": "L20: Atopic dermatitis", "code": "L20", "value": 8}, {"name": "L02: Cutaneous abscess, furuncle and carbuncle", "code": "L02", "value": 20}, {"name": "L73: Other follicular disorders", "code": "L73", "value": 3}, {"name": "L25: Unspecified contact dermatitis", "code": "L25", "value": 2}, {"name": "L82: Seborrheic keratosis", "code": "L82", "value": 1}, {"name": "L01: Impetigo", "code": "L01", "value": 4}, {"name": "L98: Other disorders of skin and subcutaneous tissue, n", "code": "L98", "value": 3}, {"name": "L27: Dermatitis due to substances taken internally", "code": "L27", "value": 2}, {"name": "L40: Psoriasis", "code": "L40", "value": 1}, {"name": "L97: Non-pressure chronic ulcer of lower limb, not else", "code": "L97", "value": 1}, {"name": "L05: Pilonidal cyst and sinus", "code": "L05", "value": 4}, {"name": "L53: Other erythematous conditions", "code": "L53", "value": 2}, {"name": "L91: Hypertrophic disorders of skin", "code": "L91", "value": 1}, {"name": "L70: Acne", "code": "L70", "value": 1}]}, {"name": "XXII: Codes for special purposes", "code": "XXII", "value": 70, "children": [{"name": "U07: Emergency use of U07", "code": "U07", "value": 70}]}, {"name": "I: Certain infectious and parasitic diseases", "code": "I", "value": 477, "children": [{"name": "B34: Viral infection of unspecified site", "code": "B34", "value": 382}, {"name": "B27: Infectious mononucleosis", "code": "B27", "value": 11}, {"name": "B85: Pediculosis and phthiriasis", "code": "B85", "value": 1}, {"name": "B08: Other viral infections characterized by skin and m", "code": "B08", "value": 4}, {"name": "B99: Other and unspecified infectious diseases", "code": "B99", "value": 18}, {"name": "B02: Zoster [herpes zoster]", "code": "B02", "value": 16}, {"name": "B00: Herpesviral [herpes simplex] infections", "code": "B00", "value": 2}, {"name": "A38: Scarlet fever", "code": "A38", "value": 3}, {"name": "B36: Other superficial mycoses", "code": "B36", "value": 4}, {"name": "A08: Viral and other specified intestinal infections", "code": "A08", "value": 5}, {"name": "A41: Other sepsis", "code": "A41", "value": 1}, {"name": "B30: Viral conjunctivitis", "code": "B30", "value": 3}, {"name": "B37: Candidiasis", "code": "B37", "value": 7}, {"name": "B07: Viral warts", "code": "B07", "value": 2}, {"name": "A74: Other diseases caused by chlamydiae", "code": "A74", "value": 1}, {"name": "A15: Respiratory tuberculosis", "code": "A15", "value": 1}, {"name": "B35: Dermatophytosis", "code": "B35", "value": 1}]}, {"name": "V: Mental and behavioural disorders", "code": "V", "value": 31, "children": [{"name": "F41: Other anxiety disorders", "code": "F41", "value": 24}, {"name": "F43: Reaction to severe stress, and adjustment disorder", "code": "F43", "value": 4}, {"name": "F03: Unspecified dementia", "code": "F03", "value": 1}, {"name": "F45: Somatoform disorders", "code": "F45", "value": 1}]}, {"name": "IV: Endocrine, nutritional and metabolic diseases", "code": "IV", "value": 8, "children": [{"name": "E86: Volume depletion", "code": "E86", "value": 1}, {"name": "E11: Type 2 diabetes mellitus", "code": "E11", "value": 4}, {"name": "E10: Type 1 diabetes mellitus", "code": "E10", "value": 1}, {"name": "E87: Other disorders of fluid, electrolyte and acid-bas", "code": "E87", "value": 2}]}, {"name": "XXI: Factors influencing health status and contact with health services", "code": "XXI", "value": 16, "children": [{"name": "Z20: Contact with and (suspected) exposure to communica", "code": "Z20", "value": 1}, {"name": "Z34: Encounter for supervision of normal pregnancy", "code": "Z34", "value": 1}, {"name": "Z48: Encounter for other postprocedural aftercare", "code": "Z48", "value": 3}, {"name": "Z98: Other postprocedural states", "code": "Z98", "value": 1}, {"name": "Z90: Acquired absence of organs, not elsewhere classifi", "code": "Z90", "value": 1}, {"name": "Z93: Artificial opening status", "code": "Z93", "value": 1}, {"name": "Z53: Persons encountering health services for specific ", "code": "Z53", "value": 1}, {"name": "Z86: Personal history of certain other diseases", "code": "Z86", "value": 1}, {"name": "Z79: Long term (current) drug therapy", "code": "Z79", "value": 1}, {"name": "Z72: Problems related to lifestyle", "code": "Z72", "value": 1}, {"name": "Z83: Family history of other specific disorders", "code": "Z83", "value": 1}, {"name": "Z51: Encounter for other aftercare and medical care", "code": "Z51", "value": 1}, {"name": "Z78: Other specified health status", "code": "Z78", "value": 1}]}, {"name": "II: Neoplasms", "code": "II", "value": 5, "children": [{"name": "D49: Neoplasms of unspecified behavior", "code": "D49", "value": 2}, {"name": "D36: Benign neoplasm of other and unspecified sites", "code": "D36", "value": 2}, {"name": "D32: Benign neoplasm of meninges", "code": "D32", "value": 1}]}, {"name": "XVII: Congenital malformations, deformations and chromosomal abnormalities", "code": "XVII", "value": 2, "children": [{"name": "Q18: Other congenital malformations of face and neck", "code": "Q18", "value": 1}, {"name": "Q82: Other congenital malformations of skin", "code": "Q82", "value": 1}]}, {"name": "XVI: Certain conditions originating in the perinatal period", "code": "XVI", "value": 3, "children": [{"name": "P38: Omphalitis of newborn", "code": "P38", "value": 1}, {"name": "P83: Other conditions of integument specific to newborn", "code": "P83", "value": 1}, {"name": "P51: Umbilical hemorrhage of newborn", "code": "P51", "value": 1}]}, {"name": "XV: Pregnancy, childbirth and the puerperium", "code": "XV", "value": 2, "children": [{"name": "O99: Other maternal diseases classifiable elsewhere but", "code": "O99", "value": 2}]}, {"name": "III: Diseases of the blood and blood-forming organs and certain disorders involving the immune mechanism", "code": "III", "value": 3, "children": [{"name": "D64: Other anemias", "code": "D64", "value": 3}]}]};
        
        // Tab switching
        function showTab(tabId) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            // Initialize charts when shown
            if (tabId === 'charts' && !window.chartsInitialized) {
                initializeCharts();
                window.chartsInitialized = true;
            } else if (tabId === 'hierarchy' && !window.sunburstInitialized) {
                initializeSunburst();
                window.sunburstInitialized = true;
            } else if (tabId === 'analysis' && !window.analysisInitialized) {
                initializeAnalysis();
                window.analysisInitialized = true;
            }
        }
        
        // Initialize Charts
        function initializeCharts() {
            // Pie Chart
            const pieCtx = document.getElementById('chapterPieChart').getContext('2d');
            new Chart(pieCtx, {
                type: 'doughnut',
                data: {
                    labels: chapterData.map(d => d.name.split(':')[0]),
                    datasets: [{
                        data: chapterData.map(d => d.value),
                        backgroundColor: [
                            '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF',
                            '#FF9F40', '#FF6384', '#C9CBCF', '#4BC0C0', '#FF6384'
                        ],
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 15,
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return label + ': ' + value + ' (' + percentage + '%)';
                                }
                            }
                        }
                    }
                }
            });
            
            // Bar Chart
            const barCtx = document.getElementById('chapterBarChart').getContext('2d');
            new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: chapterData.map(d => d.name.split(':')[0]),
                    datasets: [{
                        label: 'Número de Casos',
                        data: chapterData.map(d => d.value),
                        backgroundColor: 'rgba(0, 102, 204, 0.8)',
                        borderColor: 'rgba(0, 102, 204, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Casos: ' + context.parsed.x;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: { display: true }
                        },
                        y: {
                            grid: { display: false }
                        }
                    }
                }
            });
            
            // Category trend chart
            const catCtx = document.getElementById('categoryChart').getContext('2d');
            const categoryLabels = chapterData.map(d => d.name.split(':')[0]);
            const cumulativeData = chapterData.map((d, i) => 
                chapterData.slice(0, i + 1).reduce((sum, item) => sum + item.value, 0)
            );
            
            new Chart(catCtx, {
                type: 'line',
                data: {
                    labels: categoryLabels,
                    datasets: [{
                        label: 'Casos Acumulados',
                        data: cumulativeData,
                        borderColor: 'rgb(0, 102, 204)',
                        backgroundColor: 'rgba(0, 102, 204, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        }
        
        // Initialize Sunburst
        function initializeSunburst() {
            const width = 800;
            const height = 600;
            const radius = Math.min(width, height) / 2;
            
            const svg = d3.select("#sunburstChart")
                .append("svg")
                .attr("viewBox", `0 0 ${width} ${height}`)
                .attr("width", "100%")
                .attr("height", "100%");
            
            const g = svg.append("g")
                .attr("transform", `translate(${width/2},${height/2})`);
            
            const partition = d3.partition()
                .size([2 * Math.PI, radius]);
            
            const arc = d3.arc()
                .startAngle(d => d.x0)
                .endAngle(d => d.x1)
                .innerRadius(d => d.y0)
                .outerRadius(d => d.y1);
            
            const color = d3.scaleOrdinal(d3.schemeCategory10);
            
            const root = d3.hierarchy(hierarchyTree)
                .sum(d => d.value)
                .sort((a, b) => b.value - a.value);
            
            partition(root);
            
            const path = g.selectAll("path")
                .data(root.descendants())
                .enter().append("path")
                .attr("d", arc)
                .style("fill", d => color((d.children ? d : d.parent).data.name))
                .style("stroke", "#fff")
                .style("stroke-width", 2)
                .style("cursor", "pointer")
                .on("click", clicked)
                .on("mouseover", showTooltip)
                .on("mouseout", hideTooltip);
            
            function clicked(event, p) {
                const t = g.transition().duration(750);
                
                // Update breadcrumb
                const sequence = p.ancestors().reverse();
                const breadcrumb = sequence.map(d => d.data.name).join(" → ");
                document.getElementById("breadcrumb").innerHTML = `<span>${breadcrumb}</span>`;
                
                // Update selection info
                updateSelectionInfo(p);
                
                // Zoom animation
                root.each(d => d.target = {
                    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,
                    y0: Math.max(0, d.y0 - p.y0),
                    y1: Math.max(0, d.y1 - p.y0)
                });
                
                path.transition(t)
                    .tween("data", d => {
                        const i = d3.interpolate(d.current, d.target);
                        return t => d.current = i(t);
                    })
                    .attrTween("d", d => () => arc(d.current));
            }
            
            function showTooltip(event, d) {
                const tooltip = document.getElementById("tooltip");
                tooltip.innerHTML = `
                    <strong>${d.data.name}</strong><br>
                    Casos: ${d.value}<br>
                    ${((d.value / root.value) * 100).toFixed(1)}% del total
                `;
                tooltip.style.opacity = 1;
                tooltip.style.left = (event.pageX + 10) + "px";
                tooltip.style.top = (event.pageY - 28) + "px";
            }
            
            function hideTooltip() {
                document.getElementById("tooltip").style.opacity = 0;
            }
            
            window.resetZoom = function() {
                clicked(null, root);
            };
            
            path.each(function(d) { d.current = d; });
        }
        
        function updateSelectionInfo(node) {
            const panel = document.getElementById("selectionInfo");
            const title = document.getElementById("selectionTitle");
            const details = document.getElementById("selectionDetails");
            
            panel.style.display = "block";
            title.textContent = node.data.name;
            
            const percentage = ((node.value / hierarchyTree.value) * 100).toFixed(1);
            const children = node.children ? node.children.length : 0;
            
            details.innerHTML = `
                <div class="info-row">
                    <span>Casos totales</span>
                    <strong>${node.value}</strong>
                </div>
                <div class="info-row">
                    <span>Porcentaje del total</span>
                    <strong>${percentage}%</strong>
                </div>
                <div class="info-row">
                    <span>Subcategorías</span>
                    <strong>${children}</strong>
                </div>
            `;
        }
        
        function initializeAnalysis() {
            // Concentration chart (Pareto)
            const concCtx = document.getElementById('concentrationChart').getContext('2d');
            const sortedData = [...chapterData].sort((a, b) => b.value - a.value);
            const total = sortedData.reduce((sum, d) => sum + d.value, 0);
            let cumulative = 0;
            const cumulativePercentages = sortedData.map(d => {
                cumulative += d.value;
                return (cumulative / total) * 100;
            });
            
            new Chart(concCtx, {
                type: 'bar',
                data: {
                    labels: sortedData.map(d => d.name.split(':')[0]),
                    datasets: [{
                        type: 'bar',
                        label: 'Casos',
                        data: sortedData.map(d => d.value),
                        backgroundColor: 'rgba(0, 102, 204, 0.8)',
                        yAxisID: 'y'
                    }, {
                        type: 'line',
                        label: '% Acumulado',
                        data: cumulativePercentages,
                        borderColor: 'rgb(255, 99, 132)',
                        backgroundColor: 'rgba(255, 99, 132, 0.1)',
                        yAxisID: 'y1'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Análisis de Pareto - Concentración de Casos'
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            beginAtZero: true
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            beginAtZero: true,
                            max: 100,
                            grid: { drawOnChartArea: false },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    }
                }
            });
            
            // Specialty matrix
            createSpecialtyMatrix();
        }
        
        function createSpecialtyMatrix() {
            const specialties = {
                'Trauma/Urgencias': ['S', 'T', 'V', 'W', 'X', 'Y'],
                'Medicina Interna': ['I', 'J', 'K'],
                'Neurología': ['G', 'F'],
                'Pediatría': ['P', 'Q'],
                'Infectología': ['A', 'B'],
                'Oncología': ['C', 'D'],
                'Otros': ['E', 'H', 'L', 'M', 'N', 'O', 'R', 'U', 'Z']
            };
            
            const matrixData = [];
            Object.entries(specialties).forEach(([specialty, chapters]) => {
                const count = chapterData.filter(d => 
                    chapters.includes(d.name.split(':')[0])
                ).reduce((sum, d) => sum + d.value, 0);
                
                matrixData.push({
                    specialty: specialty,
                    count: count,
                    percentage: ((count / 6243) * 100).toFixed(1)
                });
            });
            
            const matrixHtml = `
                <table style="width: 100%;">
                    <thead>
                        <tr>
                            <th>Especialidad Médica</th>
                            <th class="text-right">Casos</th>
                            <th class="text-right">Porcentaje</th>
                            <th>Distribución</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${matrixData.map(d => `
                            <tr>
                                <td>${d.specialty}</td>
                                <td class="text-right">${d.count}</td>
                                <td class="text-right">${d.percentage}%</td>
                                <td>
                                    <div style="background: #e9ecef; height: 20px; border-radius: 10px;">
                                        <div style="background: #0066cc; height: 100%; width: ${d.percentage}%; border-radius: 10px;"></div>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            document.getElementById('specialtyMatrix').innerHTML = matrixHtml;
        }
        
        // Initialize first tab on load
        window.addEventListener('load', function() {
            // Charts will be initialized when tab is clicked
        });
    </script>
</body>
</html>